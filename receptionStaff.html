<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ti·∫øp nh·∫≠n b·ªánh nh√¢n</title>
  <link rel="stylesheet" href="receptionStaff.css" />
</head>
<body>
  <div class="container">
    <h2>Ti·∫øp nh·∫≠n b·ªánh nh√¢n</h2>

    <div class="steps">
      <button class="step active" onclick="showStep(0)">1. H·ªì s∆°</button>
      <button class="step" onclick="showStep(1)">2. Tri·ªáu ch·ª©ng</button>
      <button class="step" onclick="showStep(2)">3. Chuy·ªÉn b√°c sƒ©</button>
    </div>

    <form id="reception-form">
      <!-- Step 1 -->
      <section class="form-step active">
        <label>H·ªç v√† t√™n</label>
        <input type="text" name="fullname" id="fullName" required />

        <label>Ng√†y sinh</label>
        <input type="date" name="dob" id="birthDate" required />

        <label>Gi·ªõi t√≠nh</label>
        <select name="gender" id="gender" required>
          <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
          <option value="Nam">Nam</option>
          <option value="N·ªØ">N·ªØ</option>
        </select>

        <label>S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="tel" name="phone" required />

        <label>ƒê·ªãa ch·ªâ</label>
        <input type="text" name="address" required />

        <div class="nav-buttons">
          <button type="button" onclick="nextStep()">Ti·∫øp theo</button>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="form-step">
        <label>Tri·ªáu ch·ª©ng hi·ªán t·∫°i</label>
        <textarea name="symptoms" id="medicalHistory" rows="5" required></textarea>

        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">Quay l·∫°i</button>
          <button type="button" onclick="nextStep()">Ti·∫øp theo</button>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="form-step">
        <label>Chuy√™n khoa ph√π h·ª£p</label>
        <select id="specialty" name="specialty" required>
          <option value="">-- Ch·ªçn chuy√™n khoa --</option>
          <option value="cardiology">Tim m·∫°ch</option>
          <option value="neurology">Th·∫ßn kinh</option>
          <option value="orthopedic">X∆∞∆°ng kh·ªõp</option>
          <option value="digestive">Ti√™u ho√°</option>
        </select>

        <label>B√°c sƒ© ƒë∆∞·ª£c ph√¢n c√¥ng</label>
        <select id="assigned_doctor" name="assigned_doctor" required>
          <option value="">-- Ch·ªçn b√°c sƒ© --</option>
        </select>

        <div class="nav-buttons">
          <button type="button" onclick="prevStep()">Quay l·∫°i</button>
          <button type="submit">Ho√†n t·∫•t</button>
        </div>
      </section>
    </form>
  </div>

  <!-- Script x·ª≠ l√Ω chuy·ªÉn b∆∞·ªõc -->
  <script>
    const steps = document.querySelectorAll(".form-step");
    const indicators = document.querySelectorAll(".step");
    let currentStep = 0;

    function showStep(index) {
      steps.forEach((step, i) => {
        step.classList.toggle("active", i === index);
        indicators[i].classList.toggle("active", i === index);
      });
      currentStep = index;
    }

    function nextStep() {
      if (currentStep < steps.length - 1) showStep(currentStep + 1);
    }

    function prevStep() {
      if (currentStep > 0) showStep(currentStep - 1);
    }

    // üéØ G√°n b√°c sƒ© theo chuy√™n khoa
    const doctorList = {
      cardiology: ["BS001 - Nguy·ªÖn VƒÉn A", "BS002 - Tr·∫ßn Th·ªã B"],
      neurology: ["BS003 - L√™ Th·ªã C", "BS004 - Ph·∫°m VƒÉn D"],
      orthopedic: ["BS005 - V≈© Th·ªã E", "BS006 - ƒê·∫∑ng VƒÉn F"],
      digestive: ["BS007 - Tr·ªãnh Th·ªã G", "BS008 - Mai VƒÉn H"]
    };

    const specialtySelect = document.getElementById("specialty");
    const doctorSelect = document.getElementById("assigned_doctor");

    specialtySelect.addEventListener("change", () => {
      const selected = specialtySelect.value;
      doctorSelect.innerHTML = '<option value="">-- Ch·ªçn b√°c sƒ© --</option>';
      if (doctorList[selected]) {
        doctorList[selected].forEach(name => {
          const opt = document.createElement("option");
          opt.textContent = name;
          opt.value = name;
          doctorSelect.appendChild(opt);
        });
      }
    });

    // üéØ G·ª≠i d·ªØ li·ªáu b·ªánh nh√¢n v·ªÅ backend .NET Core
    document.getElementById("reception-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const data = {
        fullName: document.getElementById("fullName").value,
        gender: document.getElementById("gender").value,
        birthDate: document.getElementById("birthDate").value,
        medicalHistory: document.getElementById("medicalHistory").value
      };

      try {
        const response = await fetch("http://localhost:5062/api/patients", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();
        alert("‚úÖ G·ª≠i th√†nh c√¥ng! ID: " + result.id);
      } catch (error) {
        alert("‚ùå G·ª≠i th·∫•t b·∫°i: " + error.message);
      }
    });
  </script>
</body>
</html>


